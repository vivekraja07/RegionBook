<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>d3 Updating Bar Chart With Dropdown</title>

           <link rel="stylesheet" href="style.css">
           <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  
       <!-- Compiled and minified JavaScript -->
       <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
        <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.js"></script>

        <style>
        body {
            padding: 20px;
        }
        </style>
    </head>
    <body>
        <div id='vis-container' style="text-align: center;">
            <h2 style="text-align: center">Region Book</h2>
            <h6>By David Gong and Vivekanand Rajasekar</h6>
            <p>A visualization blend of race, average SAT scores, and family income for prospective college statistics. To get started, start by clicking a region or selecting a region from the top right hand corner.</p>
        </div>

        <div id="smallSelect" class="input-field col-sm-2" style="position: fixed; top: 0; right: 0; margin-right: 3em">
                <select id="regionSelect">
                  <option value="" disabled selected>Choose U.S. region
                  <option value="New England">New England</option>
                  <option value="Great Lakes">Great Lakes</option>
                  <option value="Southeast">Southeast</option>
                  <option value="Mid-Atlantic">Mid-Atlantic</option>
                  <option value="Far West">Far West</option>
                  <option value="Great Plains">Great Plains</option>
                  <option value="Southwest">Southwest</option>
                  <option value="Rocky Mountains">Rocky Mountains</option>
                </select>

                
   
              </div>

            <div id="wrapper">
            <div id="viz1">       
              <div id="chart1" style="text-align: center;">
                <svg id="mapSVG" width="960" height="600"></svg>
                <span style="margin: 10px">
                  <p id="explanation1"></p>
                </span>
              </div>
            </div>
            </div>

          <div style="text-align: center">
          <svg class="" id="svg1" width="1400" height="500" style="text-align: center">
                    <text transform="translate(300,80)">SAT Scores by Region</text>
                    <text transform="translate(978,80)">Average Family Income by Region</text>
                    <text transform="translate(15, 340) rotate(270)">SAT Scores (Mean)</text>
                    <text transform="translate(700, 340) rotate(270)">Average Family Income</text>
                    <text transform="translate(350,570)">Region</text>
                    <text transform="translate(1150,570)">Region</text>
            </svg>
            <p id="comparisonResult"></p>
          </div>

          <div id="my_dataviz" style="text-align: center;"></div>

        <span style="text-align:center; padding-top: 1em;">
            <h6 id="statisticsHeader"><u>Statistics will load once a region has been selected.</u></h6>
        </span>




   <!--      <svg id="sat_region_chart"></svg> -->


        <script type="text/javascript">
            
        </script>
        <script type="text/javascript" src="main.js"></script>   
        <script src="https://d3js.org/topojson.v2.min.js"></script>
        <script src="dropdown_statistics.js" type="text/javascript"></script>
        <script src="region_vs_national_mean_Scores.js" type="text/javascript"></script>
        <script type="text/javascript">
          // **** Your JavaScript code goes here ****
    d3.select('#svg1').selectAll("g").remove();

    var svg = d3.select('#svg1');
    var dimensions = {};
    dimensions.width = svg.attr('width') / 2 - 60 - 20;
    dimensions.height = svg.attr('height') - 120 - 80;

    var regionScale = d3.scaleBand()
        .padding(0.3)
        .range([3,dimensions.width]);

    var categoryScale = d3.scaleBand()
        .padding(0.3)
        .range([3,dimensions.width]);

    var yScale = d3.scaleLinear().range([0,dimensions.height]);
    var yScale2 = d3.scaleLinear().range([0, dimensions.height]);
    var regionColor = d3.scaleOrdinal(d3.schemeCategory10);
    var categoryColor = d3.scaleOrdinal(d3.schemeCategory10)
    var fileName = 'colleges.csv'

    var selectValue = document.getElementById("regionSelect").value

    regionChart = svg.append('g')
        .attr('transform', 'translate('+ [60, 120] +')');
    categoryChart = svg.append('g')
        .attr('transform', 'translate('+ [60*2+20+dimensions.width, 120] +')');


    d3.csv(fileName, function(error, data) {
        if (error) throw error;

        // key value nest for regions sales
        var regionDict = d3.nest()
            .key(function(d){ return d['Region']; })
            .rollup(function(v){
                var regionSales = d3.mean(v, function(d){ if (d['SAT Average'] != 0) return d['SAT Average']; })
                return regionSales;
            })
            .entries(data);

        // key value nest for category sales
        var categoryDict = d3.nest()
            .key(function(d){ return d['Region']; })
            .rollup(function(v){
                var categorySales = d3.mean(v, function(d){ if (d['SAT Average'] != 0) return d['Average Family Income']; })
                return categorySales;
            })
            .entries(data);

        // separate domain

        var regionKeys = regionDict.map(function(d) {
            return d.key;
        });
        regionScale.domain(regionKeys);

        var categoryKeys = categoryDict.map(function(d) {
            return d.key;
        });
        categoryScale.domain(categoryKeys);

        // so things don't fly over the roof

        var maxSales = d3.max(regionDict.concat(categoryDict), function(d) {
            return d.value;
        });

        yScale.domain([0, maxSales]);
        yScale2.domain([0, 1600]);

        // create bar charts

        regionChart.selectAll('.bar') 
            .data(regionDict)
            .enter()
            .append('rect')
            .attr('class', 'bar')
            .attr('x', function(d) { return regionScale(d.key); })
            .attr('y', function(d) { return dimensions.height - yScale2(d.value); })
            .attr('width', regionScale.bandwidth())
            .attr('height', function(d) { return yScale2(d.value); })
            .style('fill', function(d){ return regionColor(d.key); })
            .style('fill-opacity', function(d) {
                if (d.key == selectValue) return 1;
                else return 0.2
            });

        categoryChart.selectAll('.bar') 
            .data(categoryDict)
            .enter()
            .append('rect')
            .attr('class', 'bar')
            .attr('x', function(d) { return categoryScale(d.key); })
            .attr('y', function(d) { return dimensions.height - yScale(d.value); })
            .attr('width', categoryScale.bandwidth())
            .attr('height', function(d) { return yScale(d.value); })
            .style('fill', function(d){ return categoryColor(d.key); })
            .style('fill-opacity', function(d) {
                if (d.key == selectValue) return 1;
                else return 0.2
            });

        var yAxis = d3.axisLeft(yScale.range([dimensions.height,0]))
            .ticks(4)
            .tickFormat(function(t){ return t;})

        var yAxis2 = d3.axisLeft(yScale2.range([dimensions.height,0]))
            .ticks(4)
            .tickFormat(function(t){ return t;})



        regionChart.append('g')
            .attr('class', 'y axis')
            .call(yAxis2);
        categoryChart
            .attr('class', 'y axis')
            .call(yAxis);
            
        regionChart.append('g')
            .attr('class', 'x axis')
            .attr('transform', 'translate('+[0, dimensions.height + 10]+')')
            .call(d3.axisBottom(regionScale));
        categoryChart.append('g')
            .attr('class', 'x axis')
            .attr('transform', 'translate('+[0, dimensions.height + 10]+')')
            .call(d3.axisBottom(categoryScale));

          });
        </script>

    </body>
</html>